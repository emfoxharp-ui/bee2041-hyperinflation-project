#Start by importing the cleaned data set and the libraries that will be used
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import sklearn as sk
from sklearn.svm import SVR
data = pd.read_csv("inflation_worldbank_tidy.csv")

#begin by looking at when hyperinflation started in Bolivia
#print titles of each column
print(data.columns)
#To do this we first need just the data from Bolivia
bolivia = data[data['Country Name'] == 'Bolivia']
#Inflation is considered hyperinflation when it is over 50% a month, so we are defining hyperinflation as over 600% for a year
bolivia_hyperinflation = bolivia[bolivia['inflation_annual_%'] > 600]
print(bolivia_hyperinflation.shape)
#After limiting the data to just when there is hyperinflation in Bolivia, we can now, ensure it is sorted in chronological order
#and find the first and last year
bolivia_hyperinflation = bolivia_hyperinflation.sort_values(by='year',ascending=True)
started = bolivia_hyperinflation['year'].iloc[0]
print(started)
ended = bolivia_hyperinflation['year'].iloc[-1]
print(ended)

#Next we look at when hyperinflation was at its highest in Bolivia by sorting the data by inflation rate in descending order
#and displaying just the first row
bolivia_hyperinflation_max = bolivia_hyperinflation.sort_values(by='inflation_annual_%',ascending=False)
print(bolivia_hyperinflation_max['inflation_annual_%'].head(1))

#Next we look can create a graph to show a comparison of the inflation rate in Bolivia to the rest of the world
#We use the matplotlib library for this
#We then know hyperinflation only occures in 1984-5 so will take a 5 year period from 1982-1987 to compare within
data_range = data[(data['year'] >= 1982) & (data['year'] <= 1987)]
#We will then take a mean of the inflation rates in each year to have a comparison data
global_mean = data_range.groupby('year')['inflation_annual_%'].mean()
graph_data = [global_mean.index, global_mean.values]   
print(graph_data)
#We also need Bolivias data when it is not limited to hyperinflation but is limited to 1982-1987
bolivia_inflation = data[(data['Country Name'] == 'Bolivia') & (data['year'] >= 1982) & (data['year'] <= 1987)]
#add these on to a scatter graph
plt.plot(graph_data[0], graph_data[1], color='blue', label='global mean')
plt.plot(bolivia_inflation['year'], bolivia_inflation['inflation_annual_%'], color='red', label='Bolivia')
#add labels, legend and title to graph, as well as line
plt.legend()
plt.xlabel('Year')
plt.ylabel('Inflation Rate (%)')
plt.title('Global inflation rate vs Bolivia\'s inflation rate')
#plt.show()

#Finally we can use a regression to predict what the inflation rate would have been in Bolivia had steps not been taken to bring the inflation rate back down
#To do this we make a regression based on the data from 1982-1985
#First adjust the Bolivia date to just 1982-1985
bolivia_regression = data[(data['Country Name'] == 'Bolivia') & (data['year'] >= 1982) & (data['year'] <= 1985)]
#next use the sklearn library to create a regression
X = bolivia_regression[['year']]
y = bolivia_regression['inflation_annual_%']
regression = SVR(kernel='rbf', C=100, gamma=0.1, epsilon=.1)
regression.fit(X, y)
#next use this model to predict the inflation rate from 1986-1987
regression.predict([[1986], [1987]])
#next plot our regression onto the graph
plt.scatter(X, y, color='darkorange', label='data')
plt.plot(X, regression.predict(X), color='navy', lw=2, label='regression model')
plt.show()